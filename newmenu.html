<!--
Professional QR Menu ‚Äî single-file responsive site
Instructions (edit before hosting):
1) Replace the CSV_PUB_URL value below with your published Google Sheet CSV link.
   - In Google Sheets: File -> Share -> Publish to web -> choose sheet -> Publish
   - Use the link pattern: https://docs.google.com/spreadsheets/d/e/<SHEET_ID>/pub?output=csv
2) Save this file as `index.html` and upload to GitHub Pages or Netlify (drag & drop).
3) Generate QR(s): https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=<YOUR_SITE_URL>

This file includes:
- Mobile-first responsive layout
- Hero/header with logo area
- Menu grid rendered from Google Sheet (CSV)
- Search + category filter
- Table param support (shows table number when ?table=1)
- Lazy-load images with fallbacks
- Simple print-friendly styles
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chill Beans ‚Äî Digital Menu</title>
  <meta name="description" content="Digital QR Menu ‚Äî Chill Beans Cafe. Responsive menu powered by Google Sheets." />
  <style>
    /* Minimal modern styling (no external libs) */
    :root{
      --bg:#0f1720; --card:#0f1726; --muted:#9aa4b2; --accent:#ffb86b; --glass: rgba(255,255,255,0.03);
      --radius:14px; --max-width:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071021 0%,var(--bg) 100%);color:#e6eef6;-webkit-font-smoothing:antialiased}
    .container{max-width:var(--max-width);margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#ffb86b,#ff6b6b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071021;font-size:20px}
    h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}

    .controls{display:flex;gap:10px;margin:12px 0;flex-wrap:wrap}
    .search{flex:1;min-width:180px}
    input[type="search"], select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#071021;font-weight:600;cursor:pointer}

    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--glass);padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:8px}
    .thumb{width:100%;height:160px;object-fit:cover;border-radius:10px;background:#061323}
    .row{display:flex;justify-content:space-between;align-items:center}
    .name{font-weight:700}
    .price{color:var(--accent);font-weight:800}
    .desc{color:var(--muted);font-size:13px}
    .meta{font-size:12px;color:var(--muted)}
    .loader{padding:30px;text-align:center;color:var(--muted)}
    .error{background:#3b1c1c;color:#ffd3d3;padding:12px;border-radius:10px}

    /* small footer */
    footer{margin-top:18px;padding:12px;text-align:center;color:var(--muted);font-size:13px}
    .qr-sample{display:inline-block;margin-left:8px;vertical-align:middle}

    /* print friendly */
    @media print{
      body{background:white;color:black}
      header,footer,.controls{display:none}
      .card{border:1px solid #ddd}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">CB</div>
      <div>
        <h1>Chill Beans ‚Äî Digital Menu</h1>
        <div class="sub" id="tableInfo">Loading menu‚Ä¶</div>
      </div>
    </header>

    <section class="controls" role="region" aria-label="menu controls">
      <div style="flex:1;min-width:200px" class="search">
        <input id="search" type="search" placeholder="Search items ‚Äî name or description" aria-label="Search menu">
      </div>
      <div style="width:180px">
        <select id="categoryFilter"><option value="">All Categories</option></select>
      </div>
      <div>
        <button id="refreshBtn" class="btn">Refresh</button>
      </div>
      <div style="margin-left:auto" class="qr-sample">
        <a id="qrLink" target="_blank" title="Generate QR">üî≥ QR</a>
      </div>
    </section>

    <main id="main" aria-live="polite">
      <div id="status" class="loader">Fetching menu‚Ä¶</div>
      <div id="menuGrid" class="grid" style="display:none"></div>
    </main>

    <footer>
      Built with ‚ù§Ô∏è ‚Äî Edit your Google Sheet to update menu. Use the QR link to print for tables.
    </footer>
  </div>

<script>
(async function(){
  // === EDIT THIS: Put your published Google Sheet CSV URL here ===
  // Example pattern: https://docs.google.com/spreadsheets/d/e/<ID>/pub?output=csv
  const CSV_PUB_URL = "";
  // ==================================================================

  const statusEl = document.getElementById('status');
  const gridEl = document.getElementById('menuGrid');
  const catSelect = document.getElementById('categoryFilter');
  const searchInput = document.getElementById('search');
  const tableInfo = document.getElementById('tableInfo');
  const qrLink = document.getElementById('qrLink');

  // show table param if exists
  const params = new URLSearchParams(location.search);
  const tableNo = params.get('table');
  if(tableNo) tableInfo.textContent = `Table: ${tableNo}`;
  else tableInfo.textContent = 'Open menu ‚Äî Table not set';

  function escapeHtml(s){ return String(s||'').replace(/[&<>\"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])) }

  function parseCSV(text){
    // basic robust CSV parser (handles quoted fields)
    const rows=[]; let cur=[], field=''; let inQuotes=false; for(let i=0;i<text.length;i++){ const ch=text[i]; if(inQuotes){ if(ch==='"'){ if(text[i+1]==='"'){ field+='"'; i++; } else { inQuotes=false; } } else field+=ch; } else { if(ch==='"'){ inQuotes=true; } else if(ch===','){ cur.push(field); field=''; } else if(ch==='\r'){ continue; } else if(ch==='\n'){ cur.push(field); rows.push(cur); cur=[]; field=''; } else field+=ch; } } if(field!=='' || cur.length) { cur.push(field); rows.push(cur);} return rows; }

  async function fetchCSV(){
    try{
      statusEl.textContent = 'Loading...';
      const res = await fetch(CSV_PUB_URL, {cache:'no-store'});
      if(!res.ok) throw new Error('Fetch failed: '+res.status);
      const txt = await res.text();
      const rows = parseCSV(txt);
      if(rows.length<2) throw new Error('No data found in sheet');
      const header = rows[0].map(h=>h.trim().toLowerCase());
      const data = rows.slice(1).map(r=>{ const obj={}; for(let i=0;i<header.length;i++){ obj[header[i]] = r[i] ? r[i].trim() : ''; } return obj; });
      return data;
    } catch(err){ throw err; }
  }

  function render(items){
    const cats = new Set();
    gridEl.innerHTML = items.map(it=>{
      if(it.category) cats.add(it.category);
      const img = it.image_url || it.image || '';
      const safeImg = img ? escapeHtml(img) : '';
      return `\n<article class="card">\n  <img class="thumb" loading="lazy" src="${safeImg}" alt="${escapeHtml(it.name)}" onerror="this.onerror=null;this.src='https://i.imgur.com/6Y4bX0C.png'"/>\n  <div class=\"row\">\n    <div class=\"name\">${escapeHtml(it.name)}</div>\n    <div class=\"price\">${escapeHtml(it.price)}</div>\n  </div>\n  <div class=\"desc\">${escapeHtml(it.description)}</div>\n  <div class=\"meta\">Category: ${escapeHtml(it.category)}</div>\n</article>`;
    }).join('');
    // populate category select
    catSelect.innerHTML = '<option value="">All Categories</option>' + [...cats].map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');
  }

  function applyFilters(all){
    const q = (searchInput.value||'').trim().toLowerCase();
    const cat = catSelect.value;
    const filtered = all.filter(it=>{
      const matchesCat = !cat || (it.category||'').toLowerCase()===cat.toLowerCase();
      const hay = ((it.name||'')+' '+(it.description||'')).toLowerCase();
      const matchesQ = !q || hay.includes(q);
      return matchesCat && matchesQ;
    });
    render(filtered);
  }

  // initial load
  try{
    const allItems = await fetchCSV();
    if(!allItems.length) throw new Error('No items');
    statusEl.style.display='none'; gridEl.style.display='grid';
    render(allItems);

    // set up controls
    searchInput.addEventListener('input', ()=> applyFilters(allItems));
    catSelect.addEventListener('change', ()=> applyFilters(allItems));
    document.getElementById('refreshBtn').addEventListener('click', async ()=>{
      statusEl.style.display='block'; statusEl.textContent='Refreshing...';
      try{ const re = await fetchCSV(); statusEl.style.display='none'; render(re); } catch(e){ statusEl.textContent='Refresh failed'; console.error(e); }
    });

    // QR link (current page)
    const base = location.href.split('?')[0];
    qrLink.href = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(base+'?table=1')}`;
    qrLink.textContent = 'Generate QR for Table 1';

  } catch(err){
    statusEl.innerHTML = `<div class="error"><strong>Error:</strong> ${escapeHtml(err.message || String(err))}</div>`;
    console.error(err);
  }
})();
</script>
</body>
</html>

